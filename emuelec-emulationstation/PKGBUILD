# Maintainer: valadaa48 <valadaa48@gmx.com>

pkgname=emuelec-emulationstation
pkgver=3510.bd8040ed
pkgrel=1
pkgdesc="Emulation Station is a flexible emulator front-end supporting keyboardless navigation and custom system themes. EmuELEC edition."
arch=(any)
url="https://github.com/EmuELEC/emuelec-emulationstation"
license=('MIT')
depends=(
  vlc
  alsa-lib
  curl
  sdl2
  freeimage
  rapidjson
  libgo2
  sdl2_mixer
#  emulationstation-odroidgo2
)
#options=(debug)
makedepends=('cmake' 'curl' 'git')
optdepends=(
  'ttf-droid: Fallback fonts for Chinese/Japanese/Korean characters'
  'retroarch-odroigo2: Retroarch'
  'retroarch32-odroigo2: Retroarch32'
  'ppsspp-go2: Retroarch32'
  "es-theme-M00DY-AlekFull-Solo-Horizontal: For M00DY Sanchez's theme"
)
#provides=(emulationstation)
#conflicts=(emulationstation)
source=(
  "git+https://github.com/valadaa48/batocera-emulationstation#branch=rr"
  "emulationstation.service"
  "es_systems.cfg"
  "es_input.cfg"
  "emuelec-emulationstation-oga-fixes.patch"
)
md5sums=('SKIP'
         '1e68d88fdd5292f2361b36043810504c'
         '30aa0fb845ba98f5e3778b3baa65630b'
         'e1410f1f347a0d26bcbf5c94ae2874f4')

pkgver() {
  cd ${pkgname}
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd ${pkgname}
  git submodule update --init --recursive
  patch -p1 < ../emuelec-emulationstation-oga-fixes.patch
}

build() {
  cd ${pkgname}
  export CFLAGS=""
  export CXXFLAGS=""
  export LDFLAGS=""
  #-DENABLE_EMUELEC=1 -DDISABLE_KODI=1 -DENABLE_FILEMANAGER=1"
  cmake . -DDISABLE_KODI=1 -DGLES=1 -DENABLE_EMUELEC=1 -DENABLE_FILEMANAGER=1 -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXE_LINKER_FLAGS="-L/usr/lib/mali-egl -lGLESv2" -DUSE_GLES=on -DGL=off -DRPI=off -DCEC=off
  #cmake . -DDISABLE_KODI=1 -DGLES=1 -DENABLE_EMUELEC=1 -DENABLE_FILEMANAGER=1 -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXE_LINKER_FLAGS="-L/usr/lib/mali-egl -lGLESv2" -DUSE_GLES=on -DGL=off -DRPI=off -DCEC=off
  make -j17 V=1 VERBOSE=1
}

package() {
  install -Dm755 "$pkgname/emulationstation" -t "$pkgdir/usr/bin/emulationstation"

#  install -d "$pkgdir/usr/share/emulationstation"
  #cp -rv $pkgname/resources $pkgdir/usr/share/emulationstation

#  install -Dm644 "$pkgname/LICENSE.md" "$pkgdir/usr/share/licenses/batocera-emulationstation/LICENSE"

#  install -Dm755 emulationstation.sh $pkgdir/usr/bin/emulationstation
  install -Dm755 emulationstation.service $pkgdir/etc/systemd/system/emulationstation.service

#  install -Dm755 batocera-wifi -t "$pkgdir"/usr/bin
#  install -Dm644 batocera.conf -t "$pkgdir"/userdata/system

#  install -Dm755 BatoceraES.sh -t "$pkgdir"/roms/sh
}

